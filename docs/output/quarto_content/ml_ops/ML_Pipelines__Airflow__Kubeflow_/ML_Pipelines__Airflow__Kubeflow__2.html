<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ml_pipelines__airflow__kubeflow__2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-a37d0bf9d509de95c1ba4621f20add8c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="question-3.-describe-how-dependency-management-and-execution-scheduling-work-in-apache-airflow.-how-would-you-design-your-dag-to-handle-task-failures-retries-and-ensure-idempotency-in-tasks" class="level2">
<h2 class="anchored" data-anchor-id="question-3.-describe-how-dependency-management-and-execution-scheduling-work-in-apache-airflow.-how-would-you-design-your-dag-to-handle-task-failures-retries-and-ensure-idempotency-in-tasks">Question: 3. Describe how dependency management and execution scheduling work in Apache Airflow. How would you design your DAG to handle task failures, retries, and ensure idempotency in tasks?</h2>
<p><strong>Best Answer</strong></p>
<p>Airflow is a powerful platform for programmatically authoring, scheduling, and monitoring workflows. Its core strength lies in its Directed Acyclic Graph (DAG) structure, which defines task dependencies and the order of execution.</p>
<section id="dependency-management-and-execution-scheduling-in-airflow" class="level3">
<h3 class="anchored" data-anchor-id="dependency-management-and-execution-scheduling-in-airflow">Dependency Management and Execution Scheduling in Airflow:</h3>
<ol type="1">
<li><p><strong>DAG Structure:</strong> At the heart of Airflow is the DAG. A DAG represents a workflow as a graph, where nodes are tasks, and edges represent dependencies. The DAG definition specifies:</p>
<ul>
<li>Tasks to be executed.</li>
<li>Dependencies between tasks (which task must complete before another can start).</li>
<li>Schedule (how often the DAG should run, e.g., daily, hourly).</li>
<li>Start date (when the scheduler should start running the DAG).</li>
</ul>
<p>Example DAG definition:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow <span class="im">import</span> DAG</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.operators.bash_operator <span class="im">import</span> BashOperator</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> DAG(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    dag_id<span class="op">=</span><span class="st">'my_dag'</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    start_date<span class="op">=</span>datetime(<span class="dv">2023</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    schedule_interval<span class="op">=</span><span class="st">'@daily'</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    catchup<span class="op">=</span><span class="va">False</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>) <span class="im">as</span> dag:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    task1 <span class="op">=</span> BashOperator(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        task_id<span class="op">=</span><span class="st">'task_1'</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        bash_command<span class="op">=</span><span class="st">'echo "Task 1 running"'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    task2 <span class="op">=</span> BashOperator(</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        task_id<span class="op">=</span><span class="st">'task_2'</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        bash_command<span class="op">=</span><span class="st">'echo "Task 2 running after Task 1"'</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    task1 <span class="op">&gt;&gt;</span> task2  <span class="co"># Define dependency: task2 runs after task1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Task Dependencies:</strong> Airflow uses bitshift operators (<code>&gt;&gt;</code> and <code>&lt;&lt;</code>) to define dependencies between tasks. <code>task1 &gt;&gt; task2</code> means <code>task2</code> depends on <code>task1</code> – <code>task2</code> will only execute after <code>task1</code> has successfully completed. More complex dependencies can be created using lists or sets of tasks.</p></li>
<li><p><strong>Execution Scheduling:</strong> The Airflow scheduler is responsible for:</p>
<ul>
<li>Monitoring DAGs and tasks.</li>
<li>Triggering DAG runs based on the defined <code>schedule_interval</code>.</li>
<li>Submitting tasks to executors for execution.</li>
<li>Handling backfills (running DAGs for past dates if <code>catchup=True</code> or manually triggered).</li>
</ul>
<p>The <code>schedule_interval</code> can be a cron expression (e.g., <code>'0 0 * * *'</code> for daily at midnight), a predefined Airflow schedule (e.g., <code>'@daily'</code>, <code>'@hourly'</code>), or a <code>datetime.timedelta</code> object.</p></li>
<li><p><strong>Executors:</strong> Airflow supports different executors, which determine how tasks are executed:</p>
<ul>
<li><code>SequentialExecutor</code>: Executes tasks sequentially in a single process (suitable for testing).</li>
<li><code>LocalExecutor</code>: Executes tasks in parallel on the same machine (using multiple processes).</li>
<li><code>CeleryExecutor</code>: Distributes tasks to a Celery cluster (highly scalable, recommended for production).</li>
<li><code>KubernetesExecutor</code>: Executes each task in a separate Kubernetes pod (dynamic resource allocation, good for containerized workloads).</li>
</ul></li>
<li><p><strong>Task Instances:</strong> When a DAG runs, each task within the DAG is instantiated as a “task instance”. Each task instance has a state (e.g., <code>queued</code>, <code>running</code>, <code>success</code>, <code>failed</code>, <code>skipped</code>).</p></li>
</ol>
</section>
<section id="designing-dags-for-fault-tolerance-and-idempotency" class="level3">
<h3 class="anchored" data-anchor-id="designing-dags-for-fault-tolerance-and-idempotency">Designing DAGs for Fault Tolerance and Idempotency:</h3>
<p>To handle task failures and ensure reliable execution, consider the following strategies:</p>
<ol type="1">
<li><p><strong>Retries:</strong> Airflow allows you to configure the number of retries for a task. If a task fails, Airflow will automatically retry it up to the specified number of times.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>task <span class="op">=</span> BashOperator(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    task_id<span class="op">=</span><span class="st">'my_task'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    bash_command<span class="op">=</span><span class="st">'...'</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    retries<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    retry_delay<span class="op">=</span>timedelta(minutes<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This example will retry <code>my_task</code> up to 3 times, with a 5-minute delay between retries. The retry mechanism helps to mitigate transient errors, such as network glitches or temporary resource unavailability. The <code>retry_exponential_backoff</code> parameter can also be useful.</p></li>
<li><p><strong>Timeouts:</strong> To prevent tasks from running indefinitely, set a <code>execution_timeout</code> for each task. If a task exceeds the timeout, it will be marked as failed.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>task <span class="op">=</span> BashOperator(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    task_id<span class="op">=</span><span class="st">'my_task'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    bash_command<span class="op">=</span><span class="st">'...'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    execution_timeout<span class="op">=</span>timedelta(hours<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Idempotency:</strong> <em>Idempotency</em> is a crucial concept in distributed systems. An idempotent operation can be applied multiple times without changing the result beyond the initial application. Designing tasks to be idempotent ensures that retries do not lead to unintended side effects.</p>
<ul>
<li><p><strong>Example of Non-Idempotent Operation:</strong> Incrementing a counter in a database. If the task fails after incrementing the counter once but before confirming that the operation was completed, the task will re-run and increment the counter again when retried, resulting in an incorrect value.</p></li>
<li><p><strong>Example of Idempotent Operation:</strong> Writing a file to a specific location. If the task fails after writing part of the file, the next retry overwrites any existing data in that location, resulting in the same final state regardless of how many times it is run. Ensure the entire file is written atomically to avoid partial writes.</p></li>
<li><p><strong>Strategies for Ensuring Idempotency:</strong></p>
<ul>
<li><strong>Use unique IDs:</strong> Generate a unique identifier for each operation and use this ID to track whether the operation has already been performed.</li>
<li><strong>Atomic operations:</strong> Ensure that operations are performed atomically (all-or-nothing) to prevent partial updates. Use transactions where appropriate.</li>
<li><strong>Upsert instead of insert:</strong> If the task inserts data into a database, use an upsert (update if exists, insert if not) operation instead of a simple insert.</li>
<li><strong>Check-then-act:</strong> Before performing an operation, check whether it has already been performed.</li>
</ul></li>
</ul></li>
<li><p><strong>Error Handling:</strong></p>
<ul>
<li><strong><code>on_failure_callback</code>:</strong> Define a callback function that will be executed when a task fails. This callback can be used to send alerts, trigger other tasks, or perform cleanup operations.</li>
<li><strong><code>on_success_callback</code>:</strong> Define a callback function that will be executed when a task succeeds. This callback can be used to trigger other tasks, or perform post-processing.</li>
<li><strong><code>sla_miss_callback</code>:</strong> Define a callback function that will be executed when a task misses its Service Level Agreement (SLA). SLAs can be defined to monitor the timeliness of task execution.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> failure_callback(context):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Task failed:"</span>, context[<span class="st">'task_instance'</span>].task_id)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>task <span class="op">=</span> BashOperator(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    task_id<span class="op">=</span><span class="st">'my_task'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    bash_command<span class="op">=</span><span class="st">'...'</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    on_failure_callback<span class="op">=</span>failure_callback</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Sensors:</strong> Airflow provides sensors that wait for a certain condition to be met before proceeding. Sensors can be used to wait for files to arrive, data to become available, or external systems to reach a specific state.</p>
<p>Example: Waiting for a file to exist:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.sensors.filesystem <span class="im">import</span> FileSensor</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>wait_for_file <span class="op">=</span> FileSensor(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    task_id<span class="op">=</span><span class="st">'wait_for_file'</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    filepath<span class="op">=</span><span class="st">'/path/to/file'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    poke_interval<span class="op">=</span><span class="dv">60</span>  <span class="co"># Check every 60 seconds</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Hooks:</strong> Airflow provides hooks that allow you to interact with external systems, such as databases, cloud storage, and APIs. Hooks simplify the process of connecting to and interacting with these systems.</p></li>
<li><p><strong>Logging and Monitoring:</strong> Comprehensive logging and monitoring are essential for debugging and troubleshooting Airflow DAGs.</p>
<ul>
<li>Airflow automatically logs task execution details.</li>
<li>Use Airflow’s web UI to monitor DAG runs, task statuses, and logs.</li>
<li>Integrate with external monitoring tools (e.g., Prometheus, Grafana) to collect metrics and visualize performance.</li>
<li>Implement alerting mechanisms to notify you of task failures or SLA breaches.</li>
</ul></li>
<li><p><strong>Branching:</strong> Use <code>BranchPythonOperator</code> to create conditional workflows that execute different branches of tasks based on the outcome of previous tasks. This enables dynamic decision-making within the DAG.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.operators.python <span class="im">import</span> BranchPythonOperator</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> choose_branch():</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> condition:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'task_a'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'task_b'</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>branching <span class="op">=</span> BranchPythonOperator(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    task_id<span class="op">=</span><span class="st">'branching'</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    python_callable<span class="op">=</span>choose_branch</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>task_a <span class="op">=</span> BashOperator(task_id<span class="op">=</span><span class="st">'task_a'</span>, bash_command<span class="op">=</span><span class="st">'echo "Branch A"'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>task_b <span class="op">=</span> BashOperator(task_id<span class="op">=</span><span class="st">'task_b'</span>, bash_command<span class="op">=</span><span class="st">'echo "Branch B"'</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>branching <span class="op">&gt;&gt;</span> [task_a, task_b]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Task Groups</strong>: Airflow has a TaskGroup construct to visually and logically group tasks in the UI. While not directly affecting retry or idempotency, it helps to organize the DAG for better clarity and manageability, which indirectly aids in debugging and maintenance.</p></li>
<li><p><strong>External Task Sensor</strong>: If dependencies lie outside of the current Airflow instance (e.g., another Airflow DAG or an external process), <code>ExternalTaskSensor</code> can be used.</p></li>
</ol>
</section>
<section id="example-scenario-processing-data-from-a-cloud-storage-bucket" class="level3">
<h3 class="anchored" data-anchor-id="example-scenario-processing-data-from-a-cloud-storage-bucket">Example Scenario: Processing Data from a Cloud Storage Bucket</h3>
<p>Let’s say you have a DAG that processes data files from a cloud storage bucket. The DAG consists of the following tasks:</p>
<ol type="1">
<li><code>download_file</code>: Downloads a file from the cloud storage bucket.</li>
<li><code>process_data</code>: Processes the data in the downloaded file.</li>
<li><code>upload_results</code>: Uploads the processed results to another location.</li>
</ol>
<p>To make this DAG fault-tolerant and idempotent, you can implement the following:</p>
<ul>
<li><strong><code>download_file</code></strong>: Use a hook for the cloud provider that retries on connection or read errors. Write the downloaded file to a temporary location. Upon success of the download, atomically move the file to the final storage location.</li>
<li><strong><code>process_data</code></strong>: Ensure that the processing logic is idempotent. For example, if the processing involves updating a database, use upsert operations instead of inserts.</li>
<li><strong><code>upload_results</code></strong>: Before uploading the results, check if the results already exist in the destination location. If they do, skip the upload. Otherwise, upload the results and record the upload operation in a metadata store to prevent duplicate uploads in the future.</li>
<li>Set <code>retries</code> and <code>execution_timeout</code> for each task.</li>
<li>Implement <code>on_failure_callback</code> to send alerts if any task fails.</li>
</ul>
<p>By implementing these strategies, you can create robust and reliable Airflow DAGs that can handle task failures and ensure data consistency.</p>
<p><strong>How to Narrate</strong></p>
<p>Here’s a guide on how to articulate this in an interview:</p>
<ol type="1">
<li><p><strong>Start with a High-Level Overview:</strong></p>
<ul>
<li>Begin by stating that Airflow is a workflow management platform based on DAGs.</li>
<li>Explain that DAGs define tasks and their dependencies, enabling the scheduling and execution of complex workflows.</li>
</ul></li>
<li><p><strong>Explain Dependency Management and Scheduling:</strong></p>
<ul>
<li>Describe how tasks and dependencies are defined using Python code and bitshift operators (<code>&gt;&gt;</code> and <code>&lt;&lt;</code>).</li>
<li>Discuss the role of the Airflow scheduler in monitoring DAGs and triggering task execution.</li>
<li>Mention the different types of executors (e.g., <code>SequentialExecutor</code>, <code>LocalExecutor</code>, <code>CeleryExecutor</code>, <code>KubernetesExecutor</code>) and their use cases.</li>
</ul></li>
<li><p><strong>Address Fault Tolerance and Idempotency:</strong></p>
<ul>
<li>Introduce the concept of <em>idempotency</em> and its importance in reliable workflows.</li>
<li>Explain that idempotent operations ensure that retries do not cause unintended side effects.</li>
<li>Outline strategies for ensuring idempotency, such as using unique IDs, atomic operations, and upsert operations.</li>
<li>Discuss how to configure retries, timeouts, and error handling in Airflow tasks.</li>
<li>Explain the use of <code>on_failure_callback</code>, <code>on_success_callback</code> and <code>sla_miss_callback</code> to handle task failures and SLA breaches.</li>
</ul></li>
<li><p><strong>Mention Sensors and Hooks:</strong></p>
<ul>
<li>Explain how sensors are used to wait for specific conditions to be met before proceeding with task execution.</li>
<li>Describe how hooks are used to interact with external systems.</li>
</ul></li>
<li><p><strong>Emphasize Logging and Monitoring:</strong></p>
<ul>
<li>Highlight the importance of logging and monitoring for debugging and troubleshooting Airflow DAGs.</li>
<li>Mention Airflow’s web UI and its features for monitoring DAG runs, task statuses, and logs.</li>
<li>Suggest integrating with external monitoring tools for more comprehensive monitoring.</li>
</ul></li>
<li><p><strong>Provide an Example (Optional):</strong></p>
<ul>
<li>If time allows, briefly describe a scenario where you have implemented these strategies in a real-world project.</li>
</ul></li>
<li><p><strong>Handling Mathematical or Technical Sections:</strong></p>
<ul>
<li>For code examples, explain the purpose of each line or block of code. Avoid simply reading the code verbatim.</li>
<li>For more complex concepts like idempotency, use simple, relatable examples to illustrate the idea. For example, “Consider a task that increments a counter in a database. That’s <em>not</em> idempotent. But writing a file – where each run overwrites the last – <em>is</em> idempotent.”</li>
</ul></li>
<li><p><strong>Communication Tips:</strong></p>
<ul>
<li>Speak clearly and confidently.</li>
<li>Use simple language and avoid jargon where possible.</li>
<li>Pause to allow the interviewer to ask questions.</li>
<li>Show enthusiasm for the topic and demonstrate your expertise.</li>
<li>Structure your answer logically, starting with a high-level overview and then diving into more specific details.</li>
</ul></li>
</ol>
<p>By following these guidelines, you can deliver a clear, concise, and informative answer that showcases your expertise in Airflow and your ability to design robust and reliable workflows.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>