<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cloud_platforms__aws__gcp__azure__for_ml_4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-5d3fd86dc4559d58e199c8cc4a79ed5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="question-what-are-the-key-security-considerations-when-deploying-ml-workloads-on-cloud-platforms-like-aws-gcp-or-azure-and-how-would-you-address-potential-vulnerabilities" class="level2">
<h2 class="anchored" data-anchor-id="question-what-are-the-key-security-considerations-when-deploying-ml-workloads-on-cloud-platforms-like-aws-gcp-or-azure-and-how-would-you-address-potential-vulnerabilities">Question: What are the key security considerations when deploying ML workloads on cloud platforms like AWS, GCP, or Azure, and how would you address potential vulnerabilities?</h2>
<p><strong>Best Answer</strong></p>
<p>Deploying Machine Learning workloads on cloud platforms like AWS, GCP, or Azure introduces a unique set of security considerations that span data protection, model integrity, and infrastructure security. Addressing these concerns requires a multi-layered approach, combining platform-specific security services with general security best practices. Here’s a breakdown of the key considerations and mitigation strategies:</p>
<p><strong>1. Identity and Access Management (IAM):</strong></p>
<ul>
<li><strong>The Problem:</strong> Inadequate IAM is a primary attack vector. Over-permissive roles can allow unauthorized access to data, models, and compute resources.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Principle of Least Privilege:</strong> Grant only the minimum necessary permissions. This involves defining granular roles with specific permissions for different users and services. For example:
<ul>
<li><strong>AWS:</strong> Use IAM roles with policies that restrict access to specific S3 buckets, EC2 instances, or SageMaker resources.</li>
<li><strong>GCP:</strong> Utilize Cloud IAM roles to control access to Cloud Storage buckets, Compute Engine instances, or Vertex AI resources.</li>
<li><strong>Azure:</strong> Leverage Azure AD roles and role-based access control (RBAC) to manage permissions for Azure Machine Learning resources.</li>
</ul></li>
<li><strong>Multi-Factor Authentication (MFA):</strong> Enforce MFA for all user accounts, especially those with administrative privileges.</li>
<li><strong>Regular Audits:</strong> Conduct regular audits of IAM roles and permissions to identify and remediate any over-permissive configurations. Tools like AWS IAM Access Analyzer, GCP Policy Analyzer, and Azure Access Reviews can help.</li>
<li><strong>Service Accounts:</strong> Use service accounts for applications and services that need to access cloud resources, rather than embedding credentials directly in the code.</li>
<li><strong>IAM best practices</strong>: Segregate duties and follow the principle of separation of concerns. For example, use distinct roles for model training vs model deployment.</li>
</ul></li>
</ul>
<p><strong>2. Data Security (Encryption and Access Control):</strong></p>
<ul>
<li><strong>The Problem:</strong> Data breaches can occur if data is not properly encrypted at rest and in transit, or if access controls are not properly enforced. Sensitive data used for training or prediction may be exposed.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Encryption at Rest:</strong>
<ul>
<li><strong>Cloud Provider Managed Keys:</strong> Use the cloud provider’s key management service (e.g., AWS KMS, GCP Cloud KMS, Azure Key Vault) to encrypt data at rest.</li>
<li><strong>Customer Managed Keys (CMK):</strong> For enhanced control, use CMKs stored and managed within a hardware security module (HSM) or key management system. This allows you to control the entire key lifecycle.</li>
<li><strong>Encryption Technologies:</strong> Ensure data residing in cloud object stores (S3, GCS, Azure Blob Storage), databases (RDS, Cloud SQL, Azure SQL Database), and compute instances (EBS, Persistent Disk, Azure Disks) is encrypted.</li>
</ul></li>
<li><strong>Encryption in Transit:</strong>
<ul>
<li><strong>TLS/SSL:</strong> Enforce TLS/SSL for all communication between services and clients. Ensure that the latest TLS versions are used and that weak ciphers are disabled.</li>
<li><strong>HTTPS:</strong> Use HTTPS for all web-based interfaces and APIs.</li>
<li><strong>VPC Endpoints/Private Service Connect/Private Link:</strong> Utilize private endpoints to route traffic between services within the cloud environment, without exposing it to the public internet.</li>
</ul></li>
<li><strong>Data Masking and Anonymization:</strong> Mask or anonymize sensitive data fields before using them in training datasets, especially in non-production environments.</li>
<li><strong>Data Loss Prevention (DLP):</strong> Implement DLP measures to prevent sensitive data from leaving the cloud environment.</li>
</ul></li>
</ul>
<p><strong>3. Network Security:</strong></p>
<ul>
<li><strong>The Problem:</strong> ML workloads can be vulnerable to network-based attacks, such as denial-of-service (DoS) attacks or unauthorized access to internal resources.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Virtual Private Clouds (VPCs):</strong> Deploy ML workloads within isolated VPCs to control network traffic and restrict access.</li>
<li><strong>Security Groups/Firewall Rules:</strong> Configure security groups or firewall rules to allow only necessary traffic to and from ML instances and services. Follow the principle of least privilege in configuring network access.</li>
<li><strong>Network Segmentation:</strong> Segment the network into different zones based on security requirements. For example, separate the training environment from the production environment.</li>
<li><strong>Web Application Firewalls (WAFs):</strong> Use WAFs to protect web-based ML services from common web attacks, such as SQL injection and cross-site scripting (XSS).</li>
<li><strong>Intrusion Detection and Prevention Systems (IDS/IPS):</strong> Deploy IDS/IPS to monitor network traffic for malicious activity and automatically block or mitigate threats.</li>
<li><strong>Regular Security Audits and Penetration Testing:</strong> Perform these activities regularly.</li>
</ul></li>
</ul>
<p><strong>4. Model Security:</strong></p>
<ul>
<li><strong>The Problem:</strong> ML models can be vulnerable to adversarial attacks, such as evasion attacks (where inputs are crafted to cause the model to misclassify) or model inversion attacks (where attackers attempt to extract sensitive information from the model).</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Adversarial Training:</strong> Train models on adversarial examples to make them more robust to attacks.
<ul>
<li><span class="math display">\[x' = x + \epsilon * sign(\nabla_x L(\theta, x, y))\]</span> Where <span class="math inline">\(x'\)</span> is the adversarial example, <span class="math inline">\(x\)</span> is the original input, <span class="math inline">\(\epsilon\)</span> is a small perturbation, <span class="math inline">\(\nabla_x L(\theta, x, y)\)</span> is the gradient of the loss function <span class="math inline">\(L\)</span> with respect to the input <span class="math inline">\(x\)</span>, given the model parameters <span class="math inline">\(\theta\)</span> and the true label <span class="math inline">\(y\)</span>, and <span class="math inline">\(sign\)</span> represents the sign function.</li>
</ul></li>
<li><strong>Input Validation:</strong> Validate all input data to ensure that it conforms to expected patterns and ranges.</li>
<li><strong>Model Obfuscation:</strong> Obfuscate the model architecture and parameters to make it more difficult for attackers to reverse engineer the model.</li>
<li><strong>Regular Model Audits:</strong> Conduct regular audits of models to identify and address potential vulnerabilities. Tools to analyze model vulnerabilities are emerging.</li>
<li><strong>Differential Privacy:</strong> Add noise to the training data or model parameters to protect sensitive information.
<ul>
<li><span class="math display">\[f(x) \approx f(x') + Noise\]</span> Where <span class="math inline">\(f(x)\)</span> is the model output for input <span class="math inline">\(x\)</span>, and <span class="math inline">\(Noise\)</span> is a random noise added to ensure differential privacy.</li>
</ul></li>
<li><strong>Federated Learning:</strong> Train models on decentralized data sources without directly accessing the data. This can improve privacy, but also introduces unique security challenges.</li>
<li><strong>Model Versioning and Integrity Checks:</strong> Maintain a version control system for models and implement integrity checks to ensure that models have not been tampered with.</li>
</ul></li>
</ul>
<p><strong>5. Supply Chain Security:</strong></p>
<ul>
<li><strong>The Problem:</strong> ML workloads often rely on third-party libraries and dependencies, which can introduce vulnerabilities if they are compromised.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Dependency Scanning:</strong> Use tools to scan for known vulnerabilities in third-party dependencies.</li>
<li><strong>Software Composition Analysis (SCA):</strong> Implement SCA to identify and manage open-source components in ML workloads.</li>
<li><strong>Secure Software Development Lifecycle (SSDLC):</strong> Follow a SSDLC to ensure that security is integrated into every stage of the ML development process.</li>
<li><strong>Vendor Risk Management:</strong> Assess the security posture of third-party vendors before using their services or libraries.</li>
<li><strong>Reproducible Builds:</strong> Ensure that ML models can be built from source code in a reproducible manner, to verify their integrity.</li>
</ul></li>
</ul>
<p><strong>6. Logging and Monitoring:</strong></p>
<ul>
<li><strong>The Problem:</strong> Without adequate logging and monitoring, it can be difficult to detect and respond to security incidents.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Centralized Logging:</strong> Collect and centralize logs from all ML components (e.g., compute instances, databases, ML services) in a central logging system (e.g., AWS CloudWatch, GCP Cloud Logging, Azure Monitor).</li>
<li><strong>Security Information and Event Management (SIEM):</strong> Use a SIEM system to analyze logs for security threats and generate alerts.</li>
<li><strong>Real-time Monitoring:</strong> Monitor key metrics, such as CPU utilization, network traffic, and API access, to detect anomalies that may indicate a security incident.</li>
<li><strong>Alerting and Response:</strong> Configure alerts to notify security personnel of potential security incidents, and establish a clear incident response plan.</li>
</ul></li>
</ul>
<p><strong>7. Compliance:</strong></p>
<ul>
<li><strong>The Problem:</strong> ML workloads may be subject to various regulatory requirements, such as GDPR, HIPAA, or CCPA.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Data Residency:</strong> Ensure that data is stored in a geographic location that complies with relevant regulations.</li>
<li><strong>Data Privacy:</strong> Implement measures to protect the privacy of sensitive data, such as data masking, anonymization, and differential privacy.</li>
<li><strong>Audit Trails:</strong> Maintain audit trails of all data access and modification events.</li>
<li><strong>Compliance Certifications:</strong> Choose cloud providers that have obtained relevant compliance certifications, such as SOC 2, ISO 27001, and FedRAMP.</li>
</ul></li>
</ul>
<p><strong>8. Infrastructure as Code (IaC) and Automation:</strong></p>
<ul>
<li><strong>The Problem:</strong> Manual configuration of cloud resources can lead to inconsistencies and security vulnerabilities.</li>
<li><strong>Solutions:</strong>
<ul>
<li><strong>Terraform, CloudFormation, Azure Resource Manager:</strong> Use IaC tools to automate the provisioning and configuration of cloud resources.</li>
<li><strong>Configuration Management:</strong> Use configuration management tools (e.g., Ansible, Chef, Puppet) to enforce consistent security configurations across all ML instances.</li>
<li><strong>Continuous Integration and Continuous Deployment (CI/CD):</strong> Integrate security checks into the CI/CD pipeline to automatically identify and address vulnerabilities before they are deployed to production.</li>
<li><strong>Policy as Code:</strong> Use policy as code tools (e.g., AWS CloudFormation Guard, GCP Policy Controller, Azure Policy) to enforce security policies and prevent misconfigurations.</li>
</ul></li>
</ul>
<p>By carefully considering these security aspects and implementing the recommended mitigation strategies, organizations can securely deploy and manage ML workloads on cloud platforms.</p>
<p><strong>How to Narrate</strong></p>
<p>Here’s a guide on how to articulate this to an interviewer:</p>
<ol type="1">
<li><strong>Start with a high-level overview:</strong>
<ul>
<li>“When deploying ML workloads on cloud platforms like AWS, GCP, or Azure, security is paramount. We need a multi-layered approach covering identity, data protection, network security, model integrity, supply chain security, logging/monitoring, and compliance. The goal is to protect sensitive data, models, and infrastructure from unauthorized access, attacks, and breaches.”</li>
</ul></li>
<li><strong>Discuss IAM:</strong>
<ul>
<li>“A critical aspect is Identity and Access Management (IAM). We need to adhere to the principle of least privilege, granting only necessary permissions. On AWS, this means using IAM roles and policies to restrict access to specific resources like S3 buckets. GCP offers Cloud IAM roles for controlling access to Cloud Storage. Azure utilizes Azure AD roles. Enforcing MFA and conducting regular audits are also essential.”</li>
</ul></li>
<li><strong>Explain Data Security:</strong>
<ul>
<li>“Data security requires encrypting data both at rest and in transit. For encryption at rest, we can use cloud provider managed keys or customer-managed keys for greater control. We should always enforce TLS/SSL for all communications. Consider utilizing VPC endpoints/Private Service Connect/Private Link to avoid public internet exposure. Data masking and anonymization can be applied for non-production datasets.”</li>
</ul></li>
<li><strong>Address Network Security:</strong>
<ul>
<li>“Network security involves deploying workloads within VPCs, configuring security groups or firewall rules with least privilege, and implementing network segmentation. WAFs can protect web-based ML services, and IDS/IPS can detect and prevent intrusions.”</li>
</ul></li>
<li><strong>Explain Model Security &amp; Adversarial Attacks</strong>
<ul>
<li>“A really interesting aspect is model security. ML models are vulnerable to adversarial attacks. To mitigate this, we can use techniques like adversarial training, input validation, model obfuscation, and regular model audits.” <em>Here, briefly describe adversarial training:</em> “For example, with adversarial training, we slightly perturb the input data <span class="math inline">\(x\)</span> to create an adversarial example <span class="math inline">\(x'\)</span> using the formula: <span class="math display">\[x' = x + \epsilon * sign(\nabla_x L(\theta, x, y))\]</span> and retrain the model with these examples.”</li>
</ul></li>
<li><strong>Talk about supply chain security</strong>
<ul>
<li>“Supply chain security can be addressed through dependency scanning, software composition analysis (SCA), a secure software development lifecycle (SSDLC), and robust vendor risk management.”</li>
</ul></li>
<li><strong>Cover Logging, Monitoring, Compliance, and IaC:</strong>
<ul>
<li>“Finally, comprehensive logging and monitoring, using tools like CloudWatch, Cloud Logging, and Azure Monitor, are critical for detecting incidents. Ensure compliance with relevant regulations such as GDPR, HIPAA, or CCPA. Automating infrastructure using IaC tools like Terraform or CloudFormation, along with policy as code, ensures consistent security configurations.”</li>
</ul></li>
<li><strong>Conclude Strong:</strong>
<ul>
<li>“By addressing these key areas and implementing the right security measures, we can confidently and securely deploy ML workloads on cloud platforms.”</li>
</ul></li>
</ol>
<p><strong>Communication Tips:</strong></p>
<ul>
<li><strong>Pace yourself:</strong> Don’t rush. Give the interviewer time to process the information.</li>
<li><strong>Use clear and concise language:</strong> Avoid jargon and technical terms unless necessary.</li>
<li><strong>Provide concrete examples:</strong> Use specific examples of cloud services and tools.</li>
<li><strong>Check for understanding:</strong> Ask the interviewer if they have any questions or if they would like you to elaborate on any particular point.</li>
<li><strong>Be prepared to go deeper:</strong> If the interviewer asks for more details on a specific topic, be ready to provide them.</li>
<li><strong>For mathematical sections:</strong> Briefly explain the purpose of the formula without getting bogged down in the details. The goal is to demonstrate your understanding, not to give a lecture.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>